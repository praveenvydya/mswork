!function(t){function e(e,i){this.version=.1,this._defaults={controller:null,masterRow:0,allowMoving:!0,moveDisabled:[],moveHandle:"",moveHandleText:"&harr;",moveHandleWhere:"append",allowShowHide:!0,showHideDisabled:[],showHideHandle:"",showHideHandleText:"&plusmn;",showHideHandleWhere:"append",persistant:!1,storageKey:null,save:null,restore:null,clearStorage:null,scrollingParent:null,fixedColumns:[],fixedRows:[],beforeShowColumn:function(){},afterShowColumn:function(){},beforeHideColumn:function(){},afterHideColumn:function(){},beforeMoveColumn:function(){},afterMoveColumn:function(){}},this.settings=t.extend({},this._defaults,i),this.table=e,this.masterRow=this.table.find("tr:eq("+this.settings.masterRow+")"),this.controller=this.settings.controller?t(this.settings.controller):this.masterRow,this.controllerChildren=this.controller.children(),this.scrollingParent=this.settings.scrollingParent?t(this.settings.scrollingParent):this.table.parent(),this.settings.storageKey=this.settings.storageKey?this.settings.storageKey:window.location.href.split(/(\?|\#)/)[0].replace(/^[^a-zA-Z0-9]+$/,"")+"_"+this.table.attr("id"),this.enable()}t.extend(e.prototype,{enable:function(){var e=this;if(this.columnOrder=this.getOrder(!0),this.table.bind("beforeShowColumn.Powertable",this.settings.beforeShowColumn),this.table.bind("afterShowColumn.Powertable",this.settings.beforeShowColumn),this.table.bind("beforeHIdeColumn.Powertable",this.settings.beforeShowColumn),this.table.bind("afterHideColumn.Powertable",this.settings.beforeShowColumn),this.table.bind("beforeMoveColumn.Powertable",this.settings.beforeShowColumn),this.table.bind("afterMoveColumn.Powertable",this.settings.beforeShowColumn),this.settings.allowShowHide){for(var i=null,s=this.controllerChildren,n=0,l=this.settings.showHideDisabled.length;l>n;n++)s=s.not("[data-ptcolumn='"+this.settings.showHideDisabled[n]+"']");i=""==this.settings.showHideHandle?s[this.settings.showHideHandleWhere]('<a href="javascript:void(0)" class="ptshowhide">'+this.settings.showHideHandleText+"</a>").children("a.ptshowhide"):s.find(this.settings.showHideHandle),i.bind("click.Powertable",function(){var i=t(this),s=i.parent("[data-ptcolumn]");visible=s.data("ptcolumnvisible"),column=s.data("ptcolumn"),visible&&1==visible?(e.hideColumn(column),s.data("ptcolumnvisible",!1)):(e.showColumn(column),s.data("ptcolumnvisible",!0))})}if(this.settings.allowMoving&&"draggable"in document.createElement("span")){for(var r=null,o=this.controllerChildren,a=null,n=0,l=this.settings.moveDisabled.length;l>n;n++)o=o.not("[data-ptcolumn='"+this.settings.moveDisabled[n]+"']");""==this.settings.moveHandle?a=o[this.settings.moveHandleWhere]('<a href="javascript:void(0)" class="ptdraghandle">'+this.settings.moveHandleText+"</a>").children("a.ptdraghandle"):dragableHandles=o.find(this.settings.moveHandle),a.attr("draggable",!0).bind("dragstart.Powertable",function(){r=this}),o.bind("dragenter.Powertable",function(){t(this).addClass("ptdragover")}).bind("dragleave.Powertable",function(){t(this).removeClass("ptdragover")}).bind("dragover.Powertable",function(t){t.preventDefault&&t.preventDefault()}).bind("drop.Powertable",function(i){i.preventDefault&&i.preventDefault();var s=t(r).parent("[data-ptcolumn]")[0];s!=this&&t.contains(e.controller[0],this)&&e.moveColumn(t(s).data("ptcolumn"),t(this).data("ptcolumn")),o.filter(".ptdragover").removeClass("ptdragover")})}this.controllerChildren.data("ptcolumnvisible",!0).attr("data-ptcolumnvisible",!0),e.scrollInterval=null,this.scrollingParent.data({ptscrollx:0,ptscrolly:0}).bind("scroll.Powertable",function(){var i=t(this);e.scrollInterval||(i.trigger("scrollstart.Powertable"),e.scrollInterval=setInterval(function(){var t=i.scrollLeft(),s=i.scrollTop();1*t==1*i.data("ptscrollx")&&1*s==1*i.data("ptscrolly")&&(clearInterval(e.scrollInterval),e.scrollInterval=null,i.trigger("scrollend.Powertable")),i.data({ptscrollx:t,ptscrolly:s})},50))}),this.scrollingParent.bind("scrollstart.Powertable",function(){e._scrollStart()}),this.scrollingParent.bind("scrollend.Powertable",function(){e._scrollEnd()});for(var n=0,l=this.settings.fixedColumns.length;l>n;n++)this.fixedColumn(this.settings.fixedColumns[n]);for(var n=0,l=this.settings.fixedRows.length;l>n;n++)this.fixedRow(this.settings.fixedRows[n]);return this.settings.persistant&&this.restore(),this.table},disable:function(){return this.table.undelegate(".Powertable"),this.controller.undelegate(".Powertable"),this.scrollingParent.unbind(".Powertable"),this.table},destroy:function(){return this.disable(),this.table.removeData("powertable"),this.table},option:function(t,e){return void 0!==e?(this[t]=e,this.table):this[t]},save:function(t){return this.settings.save?this.settings.save.apply(this.table,[t,this]):window.sessionStorage&&window.JSON&&sessionStorage.setItem(this.settings.storageKey,JSON.stringify(t)),this.table},restore:function(){var e=null;return this.settings.restore?e=t.isFunction(this.settings.restore)?this.settings.restore.apply(this.table,[this]):this.settings.restore:window.sessionStorage&&window.JSON&&(e=JSON.parse(sessionStorage.getItem(this.settings.storageKey))),e&&e.length&&this.rebuild(e),this.table},clearStorage:function(){return this.settings.clearStorage?this.settings.clearStorage.apply(this.table,[this]):window.sessionStorage&&sessionStorage.removeItem(this.settings.storageKey),this.table},rebuild:function(t){for(var e=null,i=null,s=null,n=0,l=t.length;l>n;n++)e=t[n].name,i=t[n].visible,s=this.masterRow.children("[data-ptcolumn='"+e+"']"),currCtlEl=this.controller.children("[data-ptcolumn='"+e+"']").data("ptcolumnvisible",i).attr("data-ptcolumnvisible",i),n!==s.index()&&this.moveColumn(e,n),i!==s.is(":visible")&&(i?this.showColumn(e):this.hideColumn(e)),currFixed&&this.fixedColumn(e);return this.columnOrder=t,this.table},getOrder:function(e){var i=[];return!this.columnOrder||void 0!==e&&e===!0?(this.masterRow.children("[data-ptcolumn]").each(function(){var e=t(this);i.push({name:e.data("ptcolumn"),visible:e.is(":visible"),fixed:e.is("[data-ptcolumnfixed='true']")})}),i):this.columnOrder},getIndex:function(t){return/^\d+$/.test(t)?t:this.masterRow.children("[data-ptcolumn='"+t+"']").index()},moveColumn:function(e,i,s){e=this.getIndex(e),i=this.getIndex(i),s=void 0==s?!0:s;var n=new t.Event("beforeMoveColumn");if(this.table.trigger(n,[e,i]),!n.isDefaultPrevented()){if(e!==i){for(var l=this.table[0].getElementsByTagName("tr"),r=i<this.controllerChildren.length-1?"insertBefore":"appendChild",o=0,a=l.length;a>o;o++)l[o][r](l[o].children[e],l[o].children[i]);if(this.controller!=this.masterRow&&s){var h=this.controller[0].children;this.controller[0][r](h[e],h[i])}this.columnOrder=this.getOrder(!0),this.settings.persistant&&this.save(this.columnOrder)}this.table.trigger("afterMoveColumn",[e,i])}return this.table},showColumn:function(e){e=this.getIndex(e);var i=new t.Event("beforeShowColumn");if(this.table.trigger(i,[e]),!i.isDefaultPrevented()){for(var s=this.table[0].getElementsByTagName("tr"),n=0,l=s.length;l>n;n++)s[n].children[e].style.display="table-cell";this.controller.children(":eq("+e+")").data("ptcolumnvisible",!0).attr("data-ptcolumnvisible",!0),this.columnOrder=this.getOrder(!0),this.settings.persistant&&this.save(this.columnOrder),this.table.trigger("afterShowColumn",[e])}return this.table},hideColumn:function(e){e=this.getIndex(e);var i=new t.Event("beforeHideColumn");if(this.table.trigger(i,[e]),!i.isDefaultPrevented()){for(var s=this.table[0].getElementsByTagName("tr"),n=0,l=s.length;l>n;n++)s[n].children[e].style.display="none";this.controller.children(":eq("+e+")").data("ptcolumnvisible",!1).attr("data-ptcolumnvisible",!1),this.columnOrder=this.getOrder(!0),this.settings.persistant&&this.save(this.columnOrder),this.table.trigger("afterHideColumn",[e])}return this.table},fixedColumn:function(e){t.inArray(e,this.settings.fixedColumns)<0&&this.settings.fixedColumns.push(e),e=this.getIndex(e),this.table.find("tr :nth-child("+e+"1)").data("ptfixed",!0).attr("data-ptfixed",!0).addClass("ptfixed"),this.columnOrder=this.getOrder(!0)},releaseColumn:function(e){t.inArray(e,this.settings.fixedColumns)<0&&this.settings.fixedColumns.splice(e,1),this.table.find("tr :nth-child("+e+"1)").data("ptfixed",!1).attr("data-ptfixed",!1).removeClass("ptfixed"),this.columnOrder=this.getOrder(!0)},fixedRow:function(e){t.inArray(e,this.settings.fixedRows)<0&&this.settings.fixedRows.push(e),t(this.table[0].getElementsByTagName("tr")[e]).children().data("ptfixed",!0).attr("data-ptfixed",!0).addClass("ptfixed")},releaseRow:function(e){t.inArray(e,this.settings.fixedRows)<0&&this.settings.fixedRows.splice(e,1),t(this.table[0].getElementsByTagName("tr")[e]).data("ptfixed",!1).attr("data-ptfixed",!1).removeClass("ptfixed")},_scrollStart:function(){var t=(this.scrollingParent,this.settings.fixedColumns.length),e=this.settings.fixedRows.length,i=this.table[0].getElementsByTagName("tr"),s=i.length,n=this.scrollingParent.css("position");if((t>0||e>0)&&"absolute"!=n&&"relative"!=n&&this.scrollingParent.css("position","relative"),t>0)for(var l=0;t>l;l++)for(var r=this.getIndex(this.settings.fixedColumns[l]),o=0;s>o;o++){var a=i[o].children[r];a.style.position="static"}if(e>0)for(var l=0;e>l;l++)for(var h=i[this.settings.fixedRows[l]],o=0;o<h.children.length;o++){var a=h.children[o];a.style.position="static"}},_scrollEnd:function(){var t=this.scrollingParent,e=t.scrollLeft(),i=t.scrollTop(),s=this.settings.fixedColumns.length,n=this.settings.fixedRows.length,l=this.table[0].getElementsByTagName("tr"),r=l.length,o=this.scrollingParent.css("position");if((s>0||n>0)&&"absolute"!=o&&"relative"!=o&&this.scrollingParent.css("position","relative"),s>0)for(var a=0;s>a;a++)for(var h=this.getIndex(this.settings.fixedColumns[a]),d=0;r>d;d++){var c=l[d].children[h];c.style.position="relative",c.style.left=e+"px",c.style.zIndex=10}if(n>0)for(var a=0;n>a;a++)for(var u=l[this.settings.fixedRows[a]],d=0;d<u.children.length;d++){var c=u.children[d];c.style.position="relative",c.style.top=i+"px",c.style.zIndex=10-d}}}),t.fn.extend({powertable:function(i){i=i||{};var s=Array.prototype.slice.call(arguments);if("string"==typeof i){if("get"==i.substr(0,3)){var n=t(this[0]).data("powertable");return n.getOrder()}return this.each(function(){var e=t(this).data("powertable");e[i].apply(e,s.slice(1))})}return this.each(function(){var s=t(this);s.data("powertable",new e(s,i))})}})}(jQuery);