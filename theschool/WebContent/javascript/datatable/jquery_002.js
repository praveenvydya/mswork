!function(e){e.fn.columnFilter=function(t){function a(e,t,a,n,r){if("undefined"==typeof t)return new Array;"undefined"==typeof a&&(a=!0),"undefined"==typeof n&&(n=!0),"undefined"==typeof r&&(r=!0);var i;i=1==n?e.aiDisplay:e.aiDisplayMaster;for(var l=new Array,s=0,o=i.length;o>s;s++){var u=i[s],c=_.fnGetData(u),f=c[t];(1!=r||0!=f.length)&&(1==a&&jQuery.inArray(f,l)>-1||l.push(f))}return l.sort()}function n(e){return y.bUseColVis?e:_.fnSettings().oApi._fnVisibleToColumnIndex(_.fnSettings(),e)}function r(t,a,r,i,l,s){var o="text_filter";i&&(o="number_filter"),g=g.replace(/(^\s*)|(\s*$)/g,"");var u=t.fnSettings().aoPreSearchCols[d].sSearch,c="search_init ",p=g;""!=u&&"^"!=u&&(p=i&&"^"==u.charAt(0)?u.substr(1):u,c="");var v=e('<input type="text" class="'+c+o+'" value="'+p+'"/>');void 0!=s&&-1!=s&&v.attr("maxlength",s),h.html(v),h.wrapInner(i?'<span class="filter_column filter_number" />':'<span class="filter_column filter_text" />'),f[d]=g;var m=d;v.keyup(i&&!t.fnSettings().oFeatures.bServerSide?function(){t.fnFilter("^"+this.value,n(m),!0,!1),S()}:function(){if(t.fnSettings().oFeatures.bServerSide&&0!=l){var i=(t.fnSettings().aoPreSearchCols[m].sSearch,e(this).data("dt-iLastFilterLength"));"undefined"==typeof i&&(i=0);var s=this.value.length;if(Math.abs(s-i)<l)return;e(this).data("dt-iLastFilterLength",s)}t.fnFilter(this.value,n(m),a,r),S()}),v.focus(function(){e(this).hasClass("search_init")&&(e(this).removeClass("search_init"),this.value="")}),v.blur(function(){""==this.value&&(e(this).addClass("search_init"),this.value=f[m])})}function i(t){h.html(c(0));var a=t.attr("id")+"_range_from_"+d,r=e('<input type="text" class="number_range_filter" id="'+a+'" rel="'+d+'"/>');h.append(r),h.append(c(1));var i=t.attr("id")+"_range_to_"+d,l=e('<input type="text" class="number_range_filter" id="'+i+'" rel="'+d+'"/>');h.append(l),h.append(c(2)),h.wrapInner('<span class="filter_column filter_number_range" />');var s=d;m.push(d),t.dataTableExt.afnFiltering.push(function(e,r){if(t.attr("id")!=e.sTableId)return!0;if(null==document.getElementById(a))return!0;var l=1*document.getElementById(a).value,o=1*document.getElementById(i).value,u="-"==r[n(s)]?0:1*r[n(s)];return""==l&&""==o?!0:""==l&&o>=u?!0:u>=l&&""==o?!0:u>=l&&o>=u?!0:!1}),e("#"+a+",#"+i,h).keyup(function(){var e=1*document.getElementById(a).value,n=1*document.getElementById(i).value;0!=e&&0!=n&&e>n||(t.fnDraw(),S())})}function l(t,a){var r=p.split(/[}{]/);b=null!=a.dateTypes?a.dateTypes:y.dateTypes;var i,l,s=b.maxDate;i=null!=b.startYear?b.startYear:y.dateTypes.startYear,l=null!=b.endYear?b.endYear:y.dateTypes.endYear;var o;o=null!=b.dateFormat?b.dateFormat:y.dateTypes.dateFormat,h.html("");var u=t.attr("id")+"_range_from_"+d,c=e('<input type="text" class="date_range_filter" id="'+u+'" rel="'+d+'"/>'),f=t.attr("id")+"_range_to_"+d,g=e('<input type="text" class="date_range_filter" id="'+f+'" rel="'+d+'"/>');for(c.datepicker({numberOfMonths:1,changeMonth:!0,changeYear:!0,yearRange:i+":"+l,maxDate:s,dateFormat:o}),g.datepicker({numberOfMonths:1,changeMonth:!0,changeYear:!0,yearRange:i+":"+l,maxDate:s,dateFormat:o}),ti=0;ti<r.length;ti++)h.append(r[ti]==y.sDateFromToken?c:r[ti]==y.sDateToToken?g:r[ti]);h.wrapInner('<span class="filter_column filter_date_range" />');var v=d;m.push(d),t.dataTableExt.afnFiltering.push(function(a,r){if(t.attr("id")!=a.sTableId)return!0;var i=c.datepicker("getDate"),l=g.datepicker("getDate");if(null==i&&null==l)return!0;var s=null;try{if(null==r[n(v)]||""==r[n(v)])return!1;s=e.datepicker.parseDate(e.datepicker.regional[""].dateFormat,r[n(v)])}catch(o){return!1}return null==s?!1:null==i&&l>=s?!0:s>=i&&null==l?!0:s>=i&&l>=s?!0:!1}),e("#"+u+",#"+f,h).change(function(){t.fnDraw(),S()})}function s(t,n,r,i,l,s,o){null==n&&(n=a(t.fnSettings(),r,!0,!1,!0));var u=t.fnSettings().aoPreSearchCols[d].sSearch;(null==u||""==u)&&(u=o);var c='<select class="search_init select_filter"><option value="" class="search_init">'+l+"</option>",f=0,g=n.length;for(f=0;g>f;f++)if("object"!=typeof n[f]){var h="";(escape(n[f])==u||escape(n[f])==escape(u))&&(h="selected "),c+="<option "+h+' value="'+escape(n[f])+'">'+n[f]+"</option>"}else{var h="";s?(n[f].value==u&&(h="selected "),c+="<option "+h+'value="'+n[f].value+'">'+n[f].label+"</option>"):(escape(n[f].value)==u&&(h="selected "),c+="<option "+h+'value="'+escape(n[f].value)+'">'+n[f].label+"</option>")}var p=e(c+"</select>");i.html(p),i.wrapInner('<span class="filter_column filter_select" />'),p.change(function(){""!=e(this).val()?e(this).removeClass("search_init"):e(this).addClass("search_init"),s?t.fnFilter(e(this).val(),r,s):t.fnFilter(unescape(e(this).val()),r),S()}),null!=u&&""!=u&&t.fnFilter(unescape(u),r)}function o(e,t,a,r){var i=e.fnSettings();null!=t||""==i.sAjaxSource||i.oFeatures.bServerSide||i.aoDrawCallback.push({fn:function(t,l,o){return function(){return 2!=i.iDraw||null==i.sAjaxSource||""==i.sAjaxSource||i.oFeatures.bServerSide?void 0:s(e,null,n(t),l,o,a,r)}}(d,h,g),sName:"column_filter_"+d}),s(e,t,n(d),h,g,a,r)}function u(t,n){null==n&&(n=a(t.fnSettings(),d,!0,!0,!0));var r,i=d,l="",s=n.length,o=g.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("£","STERL").replace("@","AT").replace(/\s/g,"_");o=o.replace(/[^a-zA-Z 0-9]+/g,"");var u=g;(null!=y.sFilterButtonText||void 0!=y.sFilterButtonText)&&(u=y.sFilterButtonText);var c=10,f=12,p=Math.floor(s/f);s%f>0&&(p+=1);var v=100/p-2,m=c*p;1==p&&(v=20);var b='<div style="float:left; min-width: '+v+'%; " >',_="</div>",x=t.attr("id")+o,F="chkBtnOpen"+x,k=x+"-flt-toggle";for(l+='<button id="'+F+'" class="checkbox_filter" > '+u+"</button>",l+='<div id="'+k+'" title="'+g+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+m+'%; " >',l+=b,r=0;s>r;r++){r%f==0&&0!=r&&(l+=_+b),l+='<input class="search_init checkbox_filter" type="checkbox" id= "'+n[r]+'" name= "'+o+'" value="'+n[r]+'" >'+n[r]+"<br/>";var T=e(l);h.html(T),h.wrapInner('<span class="filter_column filter_checkbox" />'),T.change(function(){var a="",r="|",l=e('input:checkbox[name="'+o+'"]:checked').size();e('input:checkbox[name="'+o+'"]:checked').each(function(t){(0==t&&1==l||0!=t&&t==l-1)&&(r=""),a=a.replace(/^\s+|\s+$/g,""),a=a+e(this).val()+r,r="|"});for(var u=0;s>u;u++)""!=a?e("#"+n[u]).removeClass("search_init"):e("#"+n[u]).addClass("search_init");t.fnFilter(a,i,!0,!1),S()})}e("#"+F).button(),e("#"+k).dialog({autoOpen:!1,hide:"blind",buttons:[{text:"Reset",click:function(){return e('input:checkbox[name="'+o+'"]:checked').each(function(){e(this).attr("checked",!1),e(this).addClass("search_init")}),t.fnFilter("",i,!0,!1),S(),!1}},{text:"Close",click:function(){e(this).dialog("close")}}]}),e("#"+F).click(function(){e("#"+k).dialog("open");var t=e(this);return e("#"+k).dialog("widget").position({my:"top",at:"bottom",of:t}),!1});var D=S;S=function(){var t=e("#"+F);e("#"+k).dialog("widget").position({my:"top",at:"bottom",of:t}),D()}}function c(e){switch(e){case 0:return p.substring(0,p.indexOf("{from}"));case 1:return p.substring(p.indexOf("{from}")+6,p.indexOf("{to}"));default:return p.substring(p.indexOf("{to}")+4)}}var f,d,g,h,p="From {from} to {to}",v=new Array,m=new Array,b=null,S=function(){},_=this,x={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to",dateTypes:{maxDate:null,startYear:(new Date).getFullYear()-25,endYear:(new Date).getFullYear(),dateFormat:"yy-mm-dd"}},y=e.extend(x,t);return this.each(function(){if(_.fnSettings().oFeatures.bFilter){f=new Array;var t=_.fnSettings().aoFooter[0],a=_.fnSettings().nTFoot,n="tr";if("head:after"==y.sPlaceHolder){var s=e("tr:first",_.fnSettings().nTHead).detach();_.fnSettings().bSortCellsTop?(s.prependTo(e(_.fnSettings().nTHead)),t=_.fnSettings().aoHeader[1]):(s.appendTo(e(_.fnSettings().nTHead)),t=_.fnSettings().aoHeader[0]),n="tr:last",a=_.fnSettings().nTHead}else if("head:before"==y.sPlaceHolder){if(_.fnSettings().bSortCellsTop){var s=e("tr:first",_.fnSettings().nTHead).detach();s.appendTo(e(_.fnSettings().nTHead)),t=_.fnSettings().aoHeader[1]}else t=_.fnSettings().aoHeader[0];n="tr:first",a=_.fnSettings().nTHead}for(e(t).each(function(t){d=t;var a={type:"text",bRegex:!1,bSmart:!0,iMaxLenght:-1,iFilterLength:0};if(null!=y.aoColumns){if(y.aoColumns.length<d||null==y.aoColumns[d])return;a=y.aoColumns[d]}if(g=e(e(this)[0].cell).text(),null==a.sSelector?h=e(e(this)[0].cell):(h=e(a.sSelector),0==h.length&&(h=e(e(this)[0].cell))),null!=a)switch(p=null!=a.sRangeFormat?a.sRangeFormat:y.sRangeFormat,a.type){case"null":break;case"number":r(_,!0,!1,!0,a.iFilterLength,a.iMaxLenght);break;case"select":1!=a.bRegex&&(a.bRegex=!1),o(_,a.values,a.bRegex,a.selected);break;case"number-range":i(_);break;case"date-range":l(_,a);break;case"checkbox":u(_,a.values);break;case"text":default:bRegex=null==a.bRegex?!1:a.bRegex,bSmart=null==a.bSmart?!1:a.bSmart,r(_,bRegex,bSmart,!1,a.iFilterLength,a.iMaxLenght)}}),j=0;j<m.length;j++){var c=function(){var t=_.attr("id");return e("#"+t+"_range_from_"+m[j]).val()+y.sRangeSeparator+e("#"+t+"_range_to_"+m[j]).val()};v.push(c)}if(_.fnSettings().oFeatures.bServerSide){var b=_.fnSettings().fnServerData;_.fnSettings().fnServerData=function(t,a,n){for(j=0;j<m.length;j++){var r=m[j];for(k=0;k<a.length;k++)a[k].name=="sSearch_"+r&&(a[k].value=v[j]())}if(a.push({name:"sRangeSeparator",value:y.sRangeSeparator}),null!=b)try{b(t,a,n,_.fnSettings())}catch(i){b(t,a,n)}else e.getJSON(t,a,function(e){n(e)})}}}})}}(jQuery);