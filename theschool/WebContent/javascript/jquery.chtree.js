function _log(e,t){if(!_canLog){return}var n=Array.prototype.slice.apply(arguments,[1]);var r=new Date;var i=r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+"."+r.getMilliseconds();n[0]=i+" - "+n[0];try{switch(e){case"info":window.console.info.apply(window.console,n);break;case"warn":window.console.warn.apply(window.console,n);break;default:window.console.log.apply(window.console,n);break}}catch(s){if(!window.console){_canLog=false}else if(s.number===-2146827850){window.console.log(n.join(", "))}}}var _canLog=true;var getChTreePersistData=null;var DTNodeStatus_Error=-1;var DTNodeStatus_Loading=1;var DTNodeStatus_Ok=0;(function($){function getDtNodeFromElement(e){alert("getDtNodeFromElement is deprecated");return $.ui.chtree.getNode(e)}function noop(){}function offsetString(e){return e===0?"":e>0?"+"+e:""+e}function _checkBrowser(){function n(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}var e,t;e=n(navigator.userAgent);t={};if(e.browser){t[e.browser]=true;t.version=e.version}if(t.chrome){t.webkit=true}else if(t.webkit){t.safari=true}return t}function versionCompare(e,t){var n=(""+e).split("."),r=(""+t).split("."),i=Math.min(n.length,r.length),s,o,u;for(u=0;u<i;u++){s=parseInt(n[u],10);o=parseInt(r[u],10);if(isNaN(s)){s=n[u]}if(isNaN(o)){o=r[u]}if(s==o){continue}else if(s>o){return 1}else if(s<o){return-1}return NaN}if(n.length===r.length){return 0}return n.length<r.length?-1:1}function _initDragAndDrop(e){var t=e.options.dnd||null;if(t&&(t.onDragStart||t.onDrop)){_registerDnd()}if(t&&t.onDragStart){e.$tree.draggable({addClasses:false,appendTo:"body",containment:false,delay:0,distance:4,revert:t.revert!==true?false:function(e){if(typeof e==="boolean"){return!e}var t=$.ui.ddmanager&&$.ui.ddmanager.current&&$.ui.ddmanager.current.helper;var n=t&&t.hasClass("chtree-drop-reject");return n},scroll:true,scrollSpeed:7,scrollSensitivity:10,connectToChtree:true,helper:function(e){var t=$.ui.chtree.getNode(e.target);if(!t){return"<div></div>"}return t.tree._onDragEvent("helper",t,null,e,null,null)},start:function(e,t){var n=t.helper.data("dtSourceNode");return!!n}})}if(t&&t.onDrop){e.$tree.droppable({addClasses:false,tolerance:"pointer",greedy:false})}}var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};var BROWSER=_checkBrowser();var jquerySupports={positionMyOfs:versionCompare($.ui.version,"1.9")>=0};var ChTreeNode=Class.create();ChTreeNode.prototype={initialize:function(e,t,n){this.parent=e;this.tree=t;if(typeof n==="string"){n={title:n}}if(n.key==null){n.key="_"+t._nodeCount++}else{n.key=""+n.key}this.data=$.extend({},$.ui.chtree.nodedatadefaults,n);this.li=null;this.span=null;this.ul=null;this.childList=null;this._isLoading=false;this.hasSubSel=false;this.bExpanded=false;this.bSelected=false},toString:function(){return"ChTreeNode<"+this.data.key+">: '"+this.data.title+"'"},toDict:function(e,t){var n,r=$.extend({},this.data);r.activate=this.tree.activeNode===this;r.focus=this.tree.focusNode===this;r.expand=this.bExpanded;r.select=this.bSelected;if(t){t(r)}if(e&&this.childList){r.children=[];for(var i=0,s=this.childList.length;i<s;i++){n=this.childList[i];if(!n.isStatusNode()){r.children.push(n.toDict(true,t))}}}else{delete r.children}return r},fromDict:function(e){var t=e.children;if(t===undefined){this.data=$.extend(this.data,e);this.render();return}e=$.extend({},e);e.children=undefined;this.data=$.extend(this.data,e);this.removeChildren();this.addChild(t)},_getInnerHtml:function(){var e=this.tree,t=e.options,n=e.cache,r=this.getLevel(),i=this.data,s="",o;if(r<t.minExpandLevel){if(r>1){s+=n.tagConnector}}else if(this.hasChildren()!==false){s+=n.tagExpander}else{s+=n.tagConnector}if(t.checkbox&&i.hideCheckbox!==true&&!i.isStatusNode){s+=n.tagCheckbox}if(i.icon){if(i.icon.charAt(0)==="/"){o=i.icon}else{o=t.imagePath+i.icon}s+="<img src='"+o+"' alt='' />"}else if(i.icon===false){}else if(i.iconClass){s+="<span class='"+" "+i.iconClass+"'></span>"}else{s+=n.tagNodeIcon}var u="";if(t.onCustomRender){u=t.onCustomRender.call(e,this)||""}if(!u){var a=i.tooltip?' title="'+i.tooltip.replace(/\"/g,"&quot;")+'"':"",f=i.href||"#";if(t.noLink||i.noLink){u='<span style="display:inline-block;" class="'+t.classNames.title+'"'+a+">"+i.title+"</span>"}else{u='<a href="'+f+'" class="'+t.classNames.title+'"'+a+">"+i.title+"</a>"}}s+=u;return s},_fixOrder:function(){var e=this.childList;if(!e||!this.ul){return}var t=this.ul.firstChild;for(var n=0,r=e.length-1;n<r;n++){var i=e[n];var s=t.dtnode;if(i!==s){this.ul.insertBefore(i.li,s.li)}else{t=t.nextSibling}}},render:function(e,t){var n=this.tree,r=this.parent,i=this.data,s=n.options,o=s.classNames,u=this.isLastSibling(),a=false;if(!r&&!this.ul){this.li=this.span=null;this.ul=document.createElement("ul");if(s.minExpandLevel>1){this.ul.className=o.container+" "+o.noConnector}else{this.ul.className=o.container}}else if(r){if(!this.li){a=true;this.li=document.createElement("li");this.li.dtnode=this;if(i.key&&s.generateIds){this.li.id=s.idPrefix+i.key}this.span=document.createElement("span");this.span.className=o.title;this.li.appendChild(this.span);if(!r.ul){r.ul=document.createElement("ul");r.ul.style.display="none";r.li.appendChild(r.ul)}r.ul.appendChild(this.li)}this.span.innerHTML=this._getInnerHtml();var f=[];f.push(o.node);if(i.isFolder){f.push(o.folder)}if(this.bExpanded){f.push(o.expanded)}if(this.hasChildren()!==false){f.push(o.hasChildren)}if(i.isLazy&&this.childList===null){f.push(o.lazy)}if(u){f.push(o.lastsib)}if(this.bSelected){f.push(o.selected)}if(this.hasSubSel){f.push(o.partsel)}if(n.activeNode===this){f.push(o.active)}if(i.addClass){f.push(i.addClass)}f.push(o.combinedExpanderPrefix+(this.bExpanded?"e":"c")+(i.isLazy&&this.childList===null?"d":"")+(u?"l":""));f.push(o.combinedIconPrefix+(this.bExpanded?"e":"c")+(i.isFolder?"f":""));this.span.className=f.join(" ");this.li.className=u?o.lastsib:"";if(a&&s.onCreate){s.onCreate.call(n,this,this.span)}if(s.onRender){s.onRender.call(n,this,this.span)}}if((this.bExpanded||t===true)&&this.childList){for(var l=0,c=this.childList.length;l<c;l++){this.childList[l].render(false,t)}this._fixOrder()}if(this.ul){var h=this.ul.style.display==="none";var p=!!this.bExpanded;if(e&&s.fx&&h===p){var d=s.fx.duration||200;$(this.ul).animate(s.fx,d)}else{this.ul.style.display=this.bExpanded||!r?"":"none"}}},getKeyPath:function(e){var t=[];this.visitParents(function(e){if(e.parent){t.unshift(e.data.key)}},!e);return"/"+t.join(this.tree.options.keyPathSeparator)},getParent:function(){return this.parent},getChildren:function(){if(this.hasChildren()===undefined){return undefined}return this.childList},hasChildren:function(){if(this.data.isLazy){if(this.childList===null||this.childList===undefined){return undefined}else if(this.childList.length===0){return false}else if(this.childList.length===1&&this.childList[0].isStatusNode()){return undefined}return true}return!!this.childList},isFirstSibling:function(){var e=this.parent;return!e||e.childList[0]===this},isLastSibling:function(){var e=this.parent;return!e||e.childList[e.childList.length-1]===this},isLoading:function(){return!!this._isLoading},getPrevSibling:function(){if(!this.parent){return null}var e=this.parent.childList;for(var t=1,n=e.length;t<n;t++){if(e[t]===this){return e[t-1]}}return null},getNextSibling:function(){if(!this.parent){return null}var e=this.parent.childList;for(var t=0,n=e.length-1;t<n;t++){if(e[t]===this){return e[t+1]}}return null},isStatusNode:function(){return this.data.isStatusNode===true},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e){return false}var t=this.parent;while(t){if(t===e){return true}t=t.parent}return false},countChildren:function(){var e=this.childList;if(!e){return 0}var t=e.length;for(var n=0,r=t;n<r;n++){var i=e[n];t+=i.countChildren()}return t},sortChildren:function(e,t){var n=this.childList;if(!n){return}e=e||function(e,t){var n=e.data.title.toLowerCase(),r=t.data.title.toLowerCase();return n===r?0:n>r?1:-1};n.sort(e);if(t){for(var r=0,i=n.length;r<i;r++){if(n[r].childList){n[r].sortChildren(e,"$norender$")}}}if(t!=="$norender$"){this.render()}},_setStatusNode:function(e){var t=this.childList?this.childList[0]:null;if(!e){if(t&&t.isStatusNode()){try{if(this.ul){this.ul.removeChild(t.li);t.li=null}}catch(n){}if(this.childList.length===1){this.childList=[]}else{this.childList.shift()}}}else if(t){e.isStatusNode=true;e.key="_statusNode";t.data=e;t.render()}else{e.isStatusNode=true;e.key="_statusNode";t=this.addChild(e)}},setLazyNodeStatus:function(e,t){var n=t&&t.tooltip?t.tooltip:null,r=t&&t.info?" ("+t.info+")":"";switch(e){case DTNodeStatus_Ok:this._setStatusNode(null);$(this.span).removeClass(this.tree.options.classNames.nodeLoading);this._isLoading=false;if(this.tree.options.autoFocus){if(this===this.tree.tnRoot&&this.childList&&this.childList.length>0){this.childList[0].focus()}else{this.focus()}}break;case DTNodeStatus_Loading:this._isLoading=true;$(this.span).addClass(this.tree.options.classNames.nodeLoading);if(!this.parent){this._setStatusNode({title:this.tree.options.strings.loading+r,tooltip:n,addClass:this.tree.options.classNames.nodeWait})}break;case DTNodeStatus_Error:this._isLoading=false;this._setStatusNode({title:this.tree.options.strings.loadError+r,tooltip:n,addClass:this.tree.options.classNames.nodeError});break;default:throw"Bad LazyNodeStatus: '"+e+"'."}},_parentList:function(e,t){var n=[];var r=t?this:this.parent;while(r){if(e||r.parent){n.unshift(r)}r=r.parent}return n},getLevel:function(){var e=0;var t=this.parent;while(t){e++;t=t.parent}return e},_getTypeForOuterNodeEvent:function(e){var t=this.tree.options.classNames;var n=e.target;if(n.className.indexOf(t.node)<0){return null}var r=e.pageX-n.offsetLeft;var i=e.pageY-n.offsetTop;for(var s=0,o=n.childNodes.length;s<o;s++){var u=n.childNodes[s];var a=u.offsetLeft-n.offsetLeft;var f=u.offsetTop-n.offsetTop;var l=u.clientWidth,c=u.clientHeight;if(r>=a&&r<=a+l&&i>=f&&i<=f+c){if(u.className==t.title){return"title"}else if(u.className==t.expander){return"expander"}else if(u.className==t.checkbox){return"checkbox"}else if(u.className==t.nodeIcon){return"icon"}}}return"prefix"},getEventTargetType:function(e){var t=e&&e.target?e.target.className:"",n=this.tree.options.classNames;if(t.indexOf(n.title)>=0){return"title"}else if(t.indexOf(n.expander)>=0){return"expander"}else if(t.indexOf(n.checkbox)>=0){return"checkbox"}else if(t.indexOf(n.nodeIcon)>=0){return"icon"}else if(t.indexOf(n.empty)>=0||t.indexOf(n.vline)>=0||t.indexOf(n.connector)>=0){return"prefix"}else if(t.indexOf(n.node)>=0){return this._getTypeForOuterNodeEvent(e)}return null},isVisible:function(){var e=this._parentList(true,false);for(var t=0,n=e.length;t<n;t++){if(!e[t].bExpanded){return false}}return true},makeVisible:function(){var e=this._parentList(true,false);for(var t=0,n=e.length;t<n;t++){e[t]._expand(true)}},focus:function(){this.makeVisible();try{$(this.span).find(">a").focus()}catch(e){}},isFocused:function(){return this.tree.tnFocused===this},_activate:function(e,t){var n=this.tree.options;if(this.data.isStatusNode){return}if(t&&n.onQueryActivate&&n.onQueryActivate.call(this.tree,e,this)===false){return}if(e){if(this.tree.activeNode){if(this.tree.activeNode===this){return}this.tree.activeNode.deactivate()}if(n.activeVisible){this.makeVisible()}this.tree.activeNode=this;if(n.persist){$.cookie(n.cookieId+"-active",this.data.key,n.cookie)}this.tree.persistence.activeKey=this.data.key;$(this.span).addClass(n.classNames.active);if(t&&n.onActivate){n.onActivate.call(this.tree,this)}}else{if(this.tree.activeNode===this){if(n.onQueryActivate&&n.onQueryActivate.call(this.tree,false,this)===false){return}$(this.span).removeClass(n.classNames.active);if(n.persist){$.cookie(n.cookieId+"-active","",n.cookie)}this.tree.persistence.activeKey=null;this.tree.activeNode=null;if(t&&n.onDeactivate){n.onDeactivate.call(this.tree,this)}}}},activate:function(){this._activate(true,true)},activateSilently:function(){this._activate(true,false)},deactivate:function(){this._activate(false,true)},isActive:function(){return this.tree.activeNode===this},_userActivate:function(){var e=true;var t=false;if(this.data.isFolder){switch(this.tree.options.clickFolderMode){case 2:e=false;t=true;break;case 3:e=t=true;break}}if(this.parent===null){t=false}if(t){this.toggleExpand();this.focus()}if(e){this.activate()}},_setSubSel:function(e){if(e){this.hasSubSel=true;$(this.span).addClass(this.tree.options.classNames.partsel)}else{this.hasSubSel=false;$(this.span).removeClass(this.tree.options.classNames.partsel)}},_updatePartSelectionState:function(){var e;if(!this.hasChildren()){e=this.bSelected&&!this.data.unselectable&&!this.data.isStatusNode;this._setSubSel(false);return e}var t,n,r=this.childList,i=true,s=true;for(t=0,n=r.length;t<n;t++){var o=r[t],u=o._updatePartSelectionState();if(u!==false){s=false}if(u!==true){i=false}}if(i){e=true}else if(s){e=false}else{e=undefined}this._setSubSel(e===undefined);this.bSelected=e===true;return e},_fixSelectionState:function(){var e,t,n;if(this.bSelected){this.visit(function(e){e.parent._setSubSel(true);if(!e.data.unselectable){e._select(true,false,false)}});e=this.parent;while(e){e._setSubSel(true);var r=true;for(t=0,n=e.childList.length;t<n;t++){var i=e.childList[t];if(!i.bSelected&&!i.data.isStatusNode&&!i.data.unselectable){r=false;break}}if(r){e._select(true,false,false)}e=e.parent}}else{this._setSubSel(false);this.visit(function(e){e._setSubSel(false);e._select(false,false,false)});e=this.parent;while(e){e._select(false,false,false);var s=false;for(t=0,n=e.childList.length;t<n;t++){if(e.childList[t].bSelected||e.childList[t].hasSubSel){s=true;break}}e._setSubSel(s);e=e.parent}}},_select:function(e,t,n){var r=this.tree.options;if(this.data.isStatusNode){return}if(this.bSelected===e){return}if(t&&r.onQuerySelect&&r.onQuerySelect.call(this.tree,e,this)===false){return}if(r.selectMode==1&&e){this.tree.visit(function(e){if(e.bSelected){e._select(false,false,false);return false}})}this.bSelected=e;if(e){if(r.persist){this.tree.persistence.addSelect(this.data.key)}$(this.span).addClass(r.classNames.selected);if(n&&r.selectMode===3){this._fixSelectionState()}if(t&&r.onSelect){r.onSelect.call(this.tree,true,this)}}else{if(r.persist){this.tree.persistence.clearSelect(this.data.key)}$(this.span).removeClass(r.classNames.selected);if(n&&r.selectMode===3){this._fixSelectionState()}if(t&&r.onSelect){r.onSelect.call(this.tree,false,this)}}},select:function(e){if(this.data.unselectable){return this.bSelected}return this._select(e!==false,true,true)},toggleSelect:function(){return this.select(!this.bSelected)},isSelected:function(){return this.bSelected},isLazy:function(){return!!this.data.isLazy},_loadContent:function(){try{var e=this.tree.options;this.setLazyNodeStatus(DTNodeStatus_Loading);if(true===e.onLazyRead.call(this.tree,this)){this.setLazyNodeStatus(DTNodeStatus_Ok)}}catch(t){this.tree.logWarning("_loadContent: failed - %o",t);this.setLazyNodeStatus(DTNodeStatus_Error,{tooltip:""+t})}},_expand:function(e,t){if(this.bExpanded===e){return}var n=this.tree.options;if(!e&&this.getLevel()<n.minExpandLevel){return}if(n.onQueryExpand&&n.onQueryExpand.call(this.tree,e,this)===false){return}this.bExpanded=e;if(n.persist){if(e){this.tree.persistence.addExpand(this.data.key)}else{this.tree.persistence.clearExpand(this.data.key)}}var r=!(this.data.isLazy&&this.childList===null)&&!this._isLoading&&!t;this.render(r);if(this.bExpanded&&this.parent&&n.autoCollapse){var i=this._parentList(false,true);for(var s=0,o=i.length;s<o;s++){i[s].collapseSiblings()}}if(n.activeVisible&&this.tree.activeNode&&!this.tree.activeNode.isVisible()){this.tree.activeNode.deactivate()}if(e&&this.data.isLazy&&this.childList===null&&!this._isLoading){this._loadContent();return}if(n.onExpand){n.onExpand.call(this.tree,e,this)}},isExpanded:function(){return this.bExpanded},expand:function(e){e=e!==false;if(!this.childList&&!this.data.isLazy&&e){return}else if(this.parent===null&&!e){return}this._expand(e)},scheduleAction:function(e,t){if(this.tree.timer){clearTimeout(this.tree.timer)}var n=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.expand(true)},t);break;case"activate":this.tree.timer=setTimeout(function(){n.activate()},t);break;default:throw"Invalid mode "+e}},toggleExpand:function(){this.expand(!this.bExpanded)},collapseSiblings:function(){if(this.parent===null){return}var e=this.parent.childList;for(var t=0,n=e.length;t<n;t++){if(e[t]!==this&&e[t].bExpanded){e[t]._expand(false)}}},_onClick:function(e){var t=this.getEventTargetType(e);if(t==="expander"){this.toggleExpand();this.focus()}else if(t==="checkbox"){this.toggleSelect();this.focus()}else{this._userActivate();var n=this.span.getElementsByTagName("a");if(n[0]){if(!(BROWSER.msie&&parseInt(BROWSER.version,10)<9)){n[0].focus()}}else{return true}}e.preventDefault()},_onDblClick:function(e){},_onKeydown:function(e){var t=true,n;switch(e.which){case 107:case 187:if(!this.bExpanded){this.toggleExpand()}break;case 109:case 189:if(this.bExpanded){this.toggleExpand()}break;case 32:this._userActivate();break;case 8:if(this.parent){this.parent.focus()}break;case 37:if(this.bExpanded){this.toggleExpand();this.focus()}else if(this.parent&&this.parent.parent){this.parent.focus()}break;case 39:if(!this.bExpanded&&(this.childList||this.data.isLazy)){this.toggleExpand();this.focus()}else if(this.childList){this.childList[0].focus()}break;case 38:n=this.getPrevSibling();while(n&&n.bExpanded&&n.childList){n=n.childList[n.childList.length-1]}if(!n&&this.parent&&this.parent.parent){n=this.parent}if(n){n.focus()}break;case 40:if(this.bExpanded&&this.childList){n=this.childList[0]}else{var r=this._parentList(false,true);for(var i=r.length-1;i>=0;i--){n=r[i].getNextSibling();if(n){break}}}if(n){n.focus()}break;default:t=false}if(t){e.preventDefault()}},_onKeypress:function(e){},_onFocus:function(e){var t=this.tree.options;if(e.type=="blur"||e.type=="focusout"){if(t.onBlur){t.onBlur.call(this.tree,this)}if(this.tree.tnFocused){$(this.tree.tnFocused.span).removeClass(t.classNames.focused)}this.tree.tnFocused=null;if(t.persist){$.cookie(t.cookieId+"-focus","",t.cookie)}}else if(e.type=="focus"||e.type=="focusin"){if(this.tree.tnFocused&&this.tree.tnFocused!==this){$(this.tree.tnFocused.span).removeClass(t.classNames.focused)}this.tree.tnFocused=this;if(t.onFocus){t.onFocus.call(this.tree,this)}$(this.tree.tnFocused.span).addClass(t.classNames.focused);if(t.persist){$.cookie(t.cookieId+"-focus",this.data.key,t.cookie)}}},visit:function(e,t){var n=true;if(t===true){n=e(this);if(n===false||n==="skip"){return n}}if(this.childList){for(var r=0,i=this.childList.length;r<i;r++){n=this.childList[r].visit(e,true);if(n===false){break}}}return n},visitParents:function(e,t){if(t&&e(this)===false){return false}var n=this.parent;while(n){if(e(n)===false){return false}n=n.parent}return true},remove:function(){if(this===this.tree.root){throw"Cannot remove system root"}return this.parent.removeChild(this)},removeChild:function(e){var t=this.childList;if(t.length===1){if(e!==t[0]){throw"removeChild: invalid child"}return this.removeChildren()}if(e===this.tree.activeNode){e.deactivate()}if(this.tree.options.persist){if(e.bSelected){this.tree.persistence.clearSelect(e.data.key)}if(e.bExpanded){this.tree.persistence.clearExpand(e.data.key)}}e.removeChildren(true);if(this.ul&&e.li){this.ul.removeChild(e.li)}for(var n=0,r=t.length;n<r;n++){if(t[n]===e){this.childList.splice(n,1);break}}},removeChildren:function(e,t){var n=this.tree;var r=this.childList;if(r){for(var i=0,s=r.length;i<s;i++){var o=r[i];if(o===n.activeNode&&!t){o.deactivate()}if(this.tree.options.persist&&!t){if(o.bSelected){this.tree.persistence.clearSelect(o.data.key)}if(o.bExpanded){this.tree.persistence.clearExpand(o.data.key)}}o.removeChildren(true,t);if(this.ul&&o.li){$("li",$(this.ul)).remove()}}this.childList=null}if(!e){this._isLoading=false;this.render()}},setTitle:function(e){this.fromDict({title:e})},reload:function(e){throw"Use reloadChildren() instead"},reloadChildren:function(e){if(this.parent===null){throw"Use tree.reload() instead"}else if(!this.data.isLazy){throw"node.reloadChildren() requires lazy nodes."}if(e){var t=this;var n="nodeLoaded.chtree."+this.tree.$tree.attr("id")+"."+this.data.key;this.tree.$tree.bind(n,function(r,i,s){t.tree.$tree.unbind(n);if(i!==t){throw"got invalid load event"}e.call(t.tree,i,s)})}this.removeChildren();this._loadContent()},_loadKeyPath:function(e,t){var n=this.tree;if(e===""){throw"Key path must not be empty"}var r=e.split(n.options.keyPathSeparator);if(r[0]===""){throw"Key path must be relative (don't start with '/')"}var i=r.shift();if(this.childList){for(var s=0,o=this.childList.length;s<o;s++){var u=this.childList[s];if(u.data.key===i){if(r.length===0){t.call(n,u,"ok")}else if(u.data.isLazy&&(u.childList===null||u.childList===undefined)){var a=this;u.reloadChildren(function(i,s){if(s){t.call(n,u,"loaded");i._loadKeyPath(r.join(n.options.keyPathSeparator),t)}else{n.logWarning("%s._loadKeyPath(%s) -> reloadChildren() failed.",a,e);t.call(n,u,"error")}})}else{t.call(n,u,"loaded");u._loadKeyPath(r.join(n.options.keyPathSeparator),t)}return}}}t.call(n,undefined,"notfound",i,r.length===0);n.logWarning("Node not found: "+i);return},resetLazy:function(){if(this.parent===null){throw"Use tree.reload() instead"}else if(!this.data.isLazy){throw"node.resetLazy() requires lazy nodes."}this.expand(false);this.removeChildren()},_addChildNode:function(e,t){var n=this.tree,r=n.options,i=n.persistence;e.parent=this;if(this.childList===null){this.childList=[]}else if(!t){if(this.childList.length>0){$(this.childList[this.childList.length-1].span).removeClass(r.classNames.lastsib)}}if(t){var s=$.inArray(t,this.childList);if(s<0){throw"<beforeNode> must be a child of <this>"}this.childList.splice(s,0,e)}else{this.childList.push(e)}var o=n.isInitializing();if(r.persist&&i.cookiesFound&&o){if(i.activeKey===e.data.key){n.activeNode=e}if(i.focusedKey===e.data.key){n.focusNode=e}e.bExpanded=$.inArray(e.data.key,i.expandedKeyList)>=0;e.bSelected=$.inArray(e.data.key,i.selectedKeyList)>=0}else{if(e.data.activate){n.activeNode=e;if(r.persist){i.activeKey=e.data.key}}if(e.data.focus){n.focusNode=e;if(r.persist){i.focusedKey=e.data.key}}e.bExpanded=e.data.expand===true;if(e.bExpanded&&r.persist){i.addExpand(e.data.key)}e.bSelected=e.data.select===true;if(e.bSelected&&r.persist){i.addSelect(e.data.key)}}if(r.minExpandLevel>=e.getLevel()){this.bExpanded=true}if(e.bSelected&&r.selectMode==3){var u=this;while(u){if(!u.hasSubSel){u._setSubSel(true)}u=u.parent}}if(n.bEnableUpdate){this.render()}return e},addChild:function(e,t){if(typeof e=="string"){throw"Invalid data type for "+e}else if(!e||e.length===0){return}else if(e instanceof ChTreeNode){return this._addChildNode(e,t)}if(!e.length){e=[e]}var n=this.tree.enableUpdate(false);var r=null;for(var i=0,s=e.length;i<s;i++){var o=e[i];var u=this._addChildNode(new ChTreeNode(this,this.tree,o),t);if(!r){r=u}if(o.children){u.addChild(o.children,null)}}this.tree.enableUpdate(n);return r},append:function(e){this.tree.logWarning("node.append() is deprecated (use node.addChild() instead).");return this.addChild(e,null)},appendAjax:function(e){var t=this;this.removeChildren(false,true);this.setLazyNodeStatus(DTNodeStatus_Loading);if(e.debugLazyDelay){var n=e.debugLazyDelay;e.debugLazyDelay=0;this.tree.logInfo("appendAjax: waiting for debugLazyDelay "+n);setTimeout(function(){t.appendAjax(e)},n);return}var r=e.success,i=e.error,s="nodeLoaded.chtree."+this.tree.$tree.attr("id")+"."+this.data.key;var o=$.extend({},this.tree.options.ajaxDefaults,e,{success:function(e,n,i){var u=t.tree.phase;t.tree.phase="init";if(o.postProcess){e=o.postProcess.call(this,e,this.dataType)}else if(e&&e.hasOwnProperty("d")){e=typeof e.d=="string"?$.parseJSON(e.d):e.d}if(!$.isArray(e)||e.length!==0){t.addChild(e,null)}t.tree.phase="postInit";if(r){r.call(o,t,e,n)}t.tree.$tree.trigger(s,[t,true]);t.tree.phase=u;t.setLazyNodeStatus(DTNodeStatus_Ok);if($.isArray(e)&&e.length===0){t.childList=[];t.render()}},error:function(e,n,r){t.tree.logWarning("appendAjax failed:",n,":\n",e,"\n",r);if(i){i.call(o,t,e,n,r)}t.tree.$tree.trigger(s,[t,false]);t.setLazyNodeStatus(DTNodeStatus_Error,{info:n,tooltip:""+r})}});$.ajax(o)},move:function(e,t){var n;if(this===e){return}if(!this.parent){throw"Cannot move system root"}if(t===undefined||t=="over"){t="child"}var r=this.parent;var i=t==="child"?e:e.parent;if(i.isDescendantOf(this)){throw"Cannot move a node to it's own descendant"}if(this.parent.childList.length==1){this.parent.childList=this.parent.data.isLazy?[]:null;this.parent.bExpanded=false}else{n=$.inArray(this,this.parent.childList);if(n<0){throw"Internal error"}this.parent.childList.splice(n,1)}if(this.parent.ul){this.parent.ul.removeChild(this.li)}this.parent=i;if(i.hasChildren()){switch(t){case"child":i.childList.push(this);break;case"before":n=$.inArray(e,i.childList);if(n<0){throw"Internal error"}i.childList.splice(n,0,this);break;case"after":n=$.inArray(e,i.childList);if(n<0){throw"Internal error"}i.childList.splice(n+1,0,this);break;default:throw"Invalid mode "+t}}else{i.childList=[this]}if(!i.ul){i.ul=document.createElement("ul");i.ul.style.display="none";i.li.appendChild(i.ul)}if(this.li){i.ul.appendChild(this.li)}if(this.tree!==e.tree){this.visit(function(t){t.tree=e.tree},null,true);throw"Not yet implemented."}if(!r.isDescendantOf(i)){r.render()}if(!i.isDescendantOf(r)){i.render()}},lastentry:undefined};var ChTreeStatus=Class.create();ChTreeStatus._getTreePersistData=function(e,t){var n=new ChTreeStatus(e,t);n.read();return n.toDict()};getChTreePersistData=ChTreeStatus._getTreePersistData;ChTreeStatus.prototype={initialize:function(e,t){if(e===undefined){e=$.ui.chtree.prototype.options.cookieId}t=$.extend({},$.ui.chtree.prototype.options.cookie,t);this.cookieId=e;this.cookieOpts=t;this.cookiesFound=undefined;this.activeKey=null;this.focusedKey=null;this.expandedKeyList=null;this.selectedKeyList=null},_log:function(e){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)},read:function(){this.cookiesFound=false;var e=$.cookie(this.cookieId+"-active");this.activeKey=e||"";if(e){this.cookiesFound=true}e=$.cookie(this.cookieId+"-focus");this.focusedKey=e||"";if(e){this.cookiesFound=true}e=$.cookie(this.cookieId+"-expand");this.expandedKeyList=e?e.split(","):[];if(e){this.cookiesFound=true}e=$.cookie(this.cookieId+"-select");this.selectedKeyList=e?e.split(","):[];if(e){this.cookiesFound=true}},write:function(){$.cookie(this.cookieId+"-active",this.activeKey===null?"":this.activeKey,this.cookieOpts);$.cookie(this.cookieId+"-focus",this.focusedKey===null?"":this.focusedKey,this.cookieOpts);$.cookie(this.cookieId+"-expand",this.expandedKeyList===null?"":this.expandedKeyList.join(","),this.cookieOpts);$.cookie(this.cookieId+"-select",this.selectedKeyList===null?"":this.selectedKeyList.join(","),this.cookieOpts)},addExpand:function(e){if($.inArray(e,this.expandedKeyList)<0){this.expandedKeyList.push(e);$.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},clearExpand:function(e){var t=$.inArray(e,this.expandedKeyList);if(t>=0){this.expandedKeyList.splice(t,1);$.cookie(this.cookieId+"-expand",this.expandedKeyList.join(","),this.cookieOpts)}},addSelect:function(e){if($.inArray(e,this.selectedKeyList)<0){this.selectedKeyList.push(e);$.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts)}},clearSelect:function(e){var t=$.inArray(e,this.selectedKeyList);if(t>=0){this.selectedKeyList.splice(t,1);$.cookie(this.cookieId+"-select",this.selectedKeyList.join(","),this.cookieOpts)}},isReloading:function(){return this.cookiesFound===true},toDict:function(){return{cookiesFound:this.cookiesFound,activeKey:this.activeKey,focusedKey:this.activeKey,expandedKeyList:this.expandedKeyList,selectedKeyList:this.selectedKeyList}},lastentry:undefined};var ChTree=Class.create();ChTree.version="@@Version";ChTree.prototype={initialize:function(e){this.phase="init";this.$widget=e;this.options=e.options;this.$tree=e.element;this.timer=null;this.divTree=this.$tree.get(0);_initDragAndDrop(this)},_load:function(e){var t=this.$widget;var n=this.options,r=this;this.bEnableUpdate=true;this._nodeCount=1;this.activeNode=null;this.focusNode=null;if(n.rootVisible!==undefined){this.logWarning("Option 'rootVisible' is no longer supported.")}if(n.minExpandLevel<1){this.logWarning("Option 'minExpandLevel' must be >= 1.");n.minExpandLevel=1}if(n.classNames!==$.ui.chtree.prototype.options.classNames){n.classNames=$.extend({},$.ui.chtree.prototype.options.classNames,n.classNames)}if(n.ajaxDefaults!==$.ui.chtree.prototype.options.ajaxDefaults){n.ajaxDefaults=$.extend({},$.ui.chtree.prototype.options.ajaxDefaults,n.ajaxDefaults)}if(n.dnd!==$.ui.chtree.prototype.options.dnd){n.dnd=$.extend({},$.ui.chtree.prototype.options.dnd,n.dnd)}if(!n.imagePath){$("script").each(function(){var e=/.*chtree[^\/]*\.js$/i;if(this.src.search(e)>=0){if(this.src.indexOf("/")>=0){n.imagePath=this.src.slice(0,this.src.lastIndexOf("/"))+"/skin/"}else{n.imagePath="skin/"}return false}})}this.persistence=new ChTreeStatus(n.cookieId,n.cookie);if(n.persist){if(!$.cookie){}this.persistence.read()}this.cache={tagEmpty:"<span class='"+n.classNames.empty+"'></span>",tagVline:"<span class='"+n.classNames.vline+"'></span>",tagExpander:"<span class='"+n.classNames.expander+"'></span>",tagConnector:"<span class='"+n.classNames.connector+"'></span>",tagNodeIcon:"<span class='"+n.classNames.nodeIcon+"'></span>",tagCheckbox:"<span class='"+n.classNames.checkbox+"'></span>",lastentry:undefined};if(n.children||n.initAjax&&n.initAjax.url||n.initId){$(this.divTree).empty()}var i=this.$tree.find(">ul:first").hide();this.tnRoot=new ChTreeNode(null,this,{});this.tnRoot.bExpanded=true;this.tnRoot.render();this.divTree.appendChild(this.tnRoot.ul);var s=this.tnRoot,o=n.persist&&this.persistence.isReloading(),u=false,a=this.enableUpdate(false);if(n.children){s.addChild(n.children)}else if(n.initAjax&&n.initAjax.url){u=true;s.data.isLazy=true;this._reloadAjax(e)}else if(n.initId){this._createFromTag(s,$("#"+n.initId))}else{this._createFromTag(s,i);i.remove()}this._checkConsistency();if(!u&&n.selectMode==3){s._updatePartSelectionState()}this.enableUpdate(a);this.$widget.bind();this.phase="postInit";if(n.persist){this.persistence.write()}if(this.focusNode&&this.focusNode.isVisible()){this.focusNode.focus()}if(!u){if(n.onPostInit){n.onPostInit.call(this,o,false)}if(e){e.call(this,"ok")}}this.phase="idle"},_reloadAjax:function(e){var t=this.options;if(!t.initAjax||!t.initAjax.url){throw"tree.reload() requires 'initAjax' mode."}var n=this.persistence;var r=$.extend({},t.initAjax);if(r.addActiveKey){r.data.activeKey=n.activeKey}if(r.addFocusedKey){r.data.focusedKey=n.focusedKey}if(r.addExpandedKeyList){r.data.expandedKeyList=n.expandedKeyList.join(",")}if(r.addSelectedKeyList){r.data.selectedKeyList=n.selectedKeyList.join(",")}if(r.success){this.logWarning("initAjax: success callback is ignored; use onPostInit instead.")}if(r.error){this.logWarning("initAjax: error callback is ignored; use onPostInit instead.")}var i=n.isReloading();r.success=function(n,r,s){if(t.selectMode==3){n.tree.tnRoot._updatePartSelectionState()}if(t.onPostInit){t.onPostInit.call(n.tree,i,false)}if(e){e.call(n.tree,"ok")}};r.error=function(n,r,s,o){if(t.onPostInit){t.onPostInit.call(n.tree,i,true,r,s,o)}if(e){e.call(n.tree,"error",r,s,o)}};this.tnRoot.appendAjax(r)},toString:function(){return"Chtree '"+this.$tree.attr("id")+"'"},toDict:function(e){var t=this.tnRoot.toDict(true);return e?t:t.children},serializeArray:function(e){var t=this.getSelectedNodes(e),n=this.$tree.attr("name")||this.$tree.attr("id"),r=[];for(var i=0,s=t.length;i<s;i++){r.push({name:n,value:t[i].data.key})}return r},getPersistData:function(){return this.persistence.toDict()},logDebug:function(e){if(this.options.debugLevel>=2){Array.prototype.unshift.apply(arguments,["debug"]);_log.apply(this,arguments)}},logInfo:function(e){if(this.options.debugLevel>=1){Array.prototype.unshift.apply(arguments,["info"]);_log.apply(this,arguments)}},logWarning:function(e){Array.prototype.unshift.apply(arguments,["warn"]);_log.apply(this,arguments)},isInitializing:function(){return this.phase=="init"||this.phase=="postInit"},isReloading:function(){return(this.phase=="init"||this.phase=="postInit")&&this.options.persist&&this.persistence.cookiesFound},isUserEvent:function(){return this.phase=="userEvent"},redraw:function(){this.tnRoot.render(false,false)},renderInvisibleNodes:function(){this.tnRoot.render(false,true)},reload:function(e){this._load(e)},getRoot:function(){return this.tnRoot},enable:function(){this.$widget.enable()},disable:function(){this.$widget.disable()},getNodeByKey:function(e){var t=document.getElementById(this.options.idPrefix+e);if(t){return t.dtnode?t.dtnode:null}var n=null;this.visit(function(t){if(t.data.key===e){n=t;return false}},true);return n},getActiveNode:function(){return this.activeNode},reactivate:function(e){var t=this.activeNode;if(t){this.activeNode=null;t.activate();if(e){t.focus()}}},getSelectedNodes:function(e){var t=[];this.tnRoot.visit(function(n){if(n.bSelected){t.push(n);if(e===true){return"skip"}}});return t},activateKey:function(e){var t=e===null?null:this.getNodeByKey(e);if(!t){if(this.activeNode){this.activeNode.deactivate()}this.activeNode=null;return null}t.focus();t.activate();return t},loadKeyPath:function(e,t){var n=e.split(this.options.keyPathSeparator);if(n[0]===""){n.shift()}if(n[0]==this.tnRoot.data.key){n.shift()}e=n.join(this.options.keyPathSeparator);return this.tnRoot._loadKeyPath(e,t)},selectKey:function(e,t){var n=this.getNodeByKey(e);if(!n){return null}n.select(t);return n},enableUpdate:function(e){if(this.bEnableUpdate==e){return e}this.bEnableUpdate=e;if(e){this.redraw()}return!e},count:function(){return this.tnRoot.countChildren()},visit:function(e,t){return this.tnRoot.visit(e,t)},_createFromTag:function(parentTreeNode,$ulParent){var self=this;$ulParent.find(">li").each(function(){var $li=$(this),$liSpan=$li.find(">span:first"),$liA=$li.find(">a:first"),title,href=null,target=null,tooltip;if($liSpan.length){title=$liSpan.html()}else if($liA.length){title=$liA.html();href=$liA.attr("href");target=$liA.attr("target");tooltip=$liA.attr("title")}else{title=$li.html();var iPos=title.search(/<ul/i);if(iPos>=0){title=$.trim(title.substring(0,iPos))}else{title=$.trim(title)}}var data={title:title,tooltip:tooltip,isFolder:$li.hasClass("folder"),isLazy:$li.hasClass("lazy"),expand:$li.hasClass("expanded"),select:$li.hasClass("selected"),activate:$li.hasClass("active"),focus:$li.hasClass("focused"),noLink:$li.hasClass("noLink")};if(href){data.href=href;data.target=target}if($li.attr("title")){data.tooltip=$li.attr("title")}if($li.attr("id")){data.key=""+$li.attr("id")}if($li.attr("data")){var dataAttr=$.trim($li.attr("data"));if(dataAttr){if(dataAttr.charAt(0)!="{"){dataAttr="{"+dataAttr+"}"}try{$.extend(data,eval("("+dataAttr+")"))}catch(e){throw"Error parsing node data: "+e+"\ndata:\n'"+dataAttr+"'"}}}var childNode=parentTreeNode.addChild(data);var $ul=$li.find(">ul:first");if($ul.length){self._createFromTag(childNode,$ul)}})},_checkConsistency:function(){},_setDndStatus:function(e,t,n,r,i){var s=e?$(e.span):null,o=$(t.span),u,a=0,f="center";if(!this.$dndMarker){this.$dndMarker=$("<div id='chtree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo($(this.divTree).parent())}if(r==="after"||r==="before"||r==="over"){switch(r){case"before":this.$dndMarker.removeClass("chtree-drop-after chtree-drop-over");this.$dndMarker.addClass("chtree-drop-before");f="top";break;case"after":this.$dndMarker.removeClass("chtree-drop-before chtree-drop-over");this.$dndMarker.addClass("chtree-drop-after");f="bottom";break;default:this.$dndMarker.removeClass("chtree-drop-after chtree-drop-before");this.$dndMarker.addClass("chtree-drop-over");o.addClass("chtree-drop-target");a=8}if(jquerySupports.positionMyOfs){u={my:"left"+offsetString(a)+" center",at:"left "+f,of:o}}else{u={my:"left center",at:"left "+f,of:o,offset:""+a+" 0"}}this.$dndMarker.show().position(u)}else{o.removeClass("chtree-drop-target");this.$dndMarker.hide()}if(r==="after"){o.addClass("chtree-drop-after")}else{o.removeClass("chtree-drop-after")}if(r==="before"){o.addClass("chtree-drop-before")}else{o.removeClass("chtree-drop-before")}if(i===true){if(s){s.addClass("chtree-drop-accept")}o.addClass("chtree-drop-accept");n.addClass("chtree-drop-accept")}else{if(s){s.removeClass("chtree-drop-accept")}o.removeClass("chtree-drop-accept");n.removeClass("chtree-drop-accept")}if(i===false){if(s){s.addClass("chtree-drop-reject")}o.addClass("chtree-drop-reject");n.addClass("chtree-drop-reject")}else{if(s){s.removeClass("chtree-drop-reject")}o.removeClass("chtree-drop-reject");n.removeClass("chtree-drop-reject")}},_onDragEvent:function(e,t,n,r,i,s){var o,u,a,f=this.options.dnd,l=null,c=$(t.span);switch(e){case"helper":var h=$("<div class='chtree-drag-helper'><span class='chtree-drag-helper-img' /></div>").append($(r.target).closest(".chtree-title").clone());$("ul.chtree-container",t.tree.divTree).append(h);h.data("dtSourceNode",t);l=h;break;case"start":if(t.isStatusNode()){l=false}else if(f.onDragStart){l=f.onDragStart(t)}if(l===false){i.helper.trigger("mouseup");i.helper.hide()}else{c.addClass("chtree-drag-source")}break;case"enter":a=f.onDragEnter?f.onDragEnter(t,n,i,s):null;if(!a){l=false}else if($.isArray(a)){l={over:$.inArray("over",a)>=0,before:$.inArray("before",a)>=0,after:$.inArray("after",a)>=0}}else{l={over:a===true||a==="over",before:a===true||a==="before",after:a===true||a==="after"}}i.helper.data("enterResponse",l);break;case"over":u=i.helper.data("enterResponse");o=null;if(u===false){}else if(typeof u==="string"){o=u}else{var p=c.offset();var d={x:r.pageX-p.left,y:r.pageY-p.top};var v={x:d.x/c.width(),y:d.y/c.height()};if(u.after&&v.y>.75){o="after"}else if(!u.over&&u.after&&v.y>.5){o="after"}else if(u.before&&v.y<=.25){o="before"}else if(!u.over&&u.before&&v.y<=.5){o="before"}else if(u.over){o="over"}if(f.preventVoidMoves){if(t===n){o=null}else if(o==="before"&&n&&t===n.getNextSibling()){o=null}else if(o==="after"&&n&&t===n.getPrevSibling()){o=null}else if(o==="over"&&n&&n.parent===t&&n.isLastSibling()){o=null}}i.helper.data("hitMode",o)}if(o==="over"&&f.autoExpandMS&&t.hasChildren()!==false&&!t.bExpanded){t.scheduleAction("expand",f.autoExpandMS)}if(o&&f.onDragOver){l=f.onDragOver(t,n,o,i,s);if(l==="over"||l==="before"||l==="after"){o=l}}this._setDndStatus(n,t,i.helper,o,l!==false&&o!==null);break;case"drop":var m=i.helper.hasClass("chtree-drop-reject");o=i.helper.data("hitMode");if(o&&f.onDrop&&!m){f.onDrop(t,n,o,i,s)}break;case"leave":t.scheduleAction("cancel");i.helper.data("enterResponse",null);i.helper.data("hitMode",null);this._setDndStatus(n,t,i.helper,"out",undefined);if(f.onDragLeave){f.onDragLeave(t,n,i,s)}break;case"stop":c.removeClass("chtree-drag-source");if(f.onDragStop){f.onDragStop(t)}break;default:throw"Unsupported drag event: "+e}return l},cancelDrag:function(){var e=$.ui.ddmanager.current;if(e){e.cancel()}},lastentry:undefined};$.widget("ui.chtree",{_init:function(){if(versionCompare($.ui.version,"1.8")<0){if(this.options.debugLevel>=0){}return this._create()}if(this.options.debugLevel>=2){}},_create:function(){var e=this.options;if(e.debugLevel>=1){}this.options.event+=".chtree";var t=this.element.get(0);this.tree=new ChTree(this);this.tree._load()},bind:function(){function t(e){e=$.event.fix(e||window.event);var t=$.ui.chtree.getNode(e.target);return t?t._onFocus(e):false}this.unbind();var e="click.chtree dblclick.chtree";if(this.options.keyboard){e+=" keypress.chtree keydown.chtree"}this.element.bind(e,function(e){var t=$.ui.chtree.getNode(e.target);if(!t){return true}var n=t.tree;var r=n.options;var i=n.phase;n.phase="userEvent";try{switch(e.type){case"click":return r.onClick&&r.onClick.call(n,t,e)===false?false:t._onClick(e);case"dblclick":return r.onDblClick&&r.onDblClick.call(n,t,e)===false?false:t._onDblClick(e);case"keydown":return r.onKeydown&&r.onKeydown.call(n,t,e)===false?false:t._onKeydown(e);case"keypress":return r.onKeypress&&r.onKeypress.call(n,t,e)===false?false:t._onKeypress(e)}}catch(s){var o=null;n.logWarning("bind(%o): dtnode: %o, error: %o",e,t,s)}finally{n.phase=i}});var n=this.tree.divTree;if(n.addEventListener){n.addEventListener("focus",t,true);n.addEventListener("blur",t,true)}else{n.onfocusin=n.onfocusout=t}},unbind:function(){this.element.unbind(".chtree")},enable:function(){this.bind();$.Widget.prototype.enable.apply(this,arguments)},disable:function(){this.unbind();$.Widget.prototype.disable.apply(this,arguments)},getTree:function(){return this.tree},getRoot:function(){return this.tree.getRoot()},getActiveNode:function(){return this.tree.getActiveNode()},getSelectedNodes:function(){return this.tree.getSelectedNodes()},lastentry:undefined});if(versionCompare($.ui.version,"1.8")<0){$.ui.chtree.getter="getTree getRoot getActiveNode getSelectedNodes"}$.extend($.ui.chtree,{version:"DEVELOPMENT",buildType:"DEVELOP",_ChTreeClass:ChTree,_ChTreeNodeClass:ChTreeNode,getNode:function(e){if(e instanceof ChTreeNode){return e}if(e.selector!==undefined){e=e[0]}while(e){if(e.dtnode){return e.dtnode}e=e.parentNode}return null},getPersistData:ChTreeStatus._getTreePersistData});$.ui.chtree.prototype.options={title:"Chtree",minExpandLevel:1,imagePath:null,children:null,initId:null,initAjax:null,autoFocus:true,keyboard:true,persist:false,autoCollapse:false,clickFolderMode:3,activeVisible:true,checkbox:false,selectMode:2,fx:null,noLink:false,onClick:null,onDblClick:null,onKeydown:null,onKeypress:null,onFocus:null,onBlur:null,onQueryActivate:null,onQuerySelect:null,onQueryExpand:null,onPostInit:null,onActivate:null,onDeactivate:null,onSelect:null,onExpand:null,onLazyRead:null,onCustomRender:null,onCreate:null,onRender:null,postProcess:null,dnd:{onDragStart:null,onDragStop:null,revert:false,autoExpandMS:1e3,preventVoidMoves:true,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},ajaxDefaults:{cache:false,timeout:0,dataType:"json"},strings:{loading:"Loading&#8230;",loadError:"Load error!"},generateIds:false,idPrefix:"chtree-id-",keyPathSeparator:"/",cookieId:"chtree",cookie:{expires:null},classNames:{container:"chtree-container",node:"chtree-node",folder:"chtree-folder",empty:"chtree-empty",vline:"chtree-vline",expander:"chtree-expander",connector:"chtree-connector",checkbox:"chtree-checkbox",nodeIcon:"chtree-icon",title:"chtree-title",noConnector:"chtree-no-connector",nodeError:"chtree-statusnode-error",nodeWait:"chtree-statusnode-wait",hidden:"chtree-hidden",combinedExpanderPrefix:"chtree-exp-",combinedIconPrefix:"chtree-ico-",nodeLoading:"chtree-loading",hasChildren:"chtree-has-children",active:"chtree-active",selected:"chtree-selected",expanded:"chtree-expanded",lazy:"chtree-lazy",focused:"chtree-focused",partsel:"chtree-partsel",lastsib:"chtree-lastsib"},debugLevel:2,lastentry:undefined};if(versionCompare($.ui.version,"1.8")<0){$.ui.chtree.defaults=$.ui.chtree.prototype.options}$.ui.chtree.nodedatadefaults={title:null,key:null,isFolder:false,isLazy:false,tooltip:null,href:null,icon:null,addClass:null,noLink:false,activate:false,focus:false,expand:false,select:false,hideCheckbox:false,unselectable:false,children:null,lastentry:undefined};var didRegisterDnd=false;var _registerDnd=function(){if(didRegisterDnd){return}$.ui.plugin.add("draggable","connectToChtree",{start:function(e,t){var n=$(this).data("ui-draggable")||$(this).data("draggable"),r=t.helper.data("dtSourceNode")||null;if(r){n.offset.click.top=-2;n.offset.click.left=+16;return r.tree._onDragEvent("start",r,null,e,t,n)}},drag:function(e,t){var n=$(this).data("ui-draggable")||$(this).data("draggable"),r=t.helper.data("dtSourceNode")||null,i=t.helper.data("dtTargetNode")||null,s=$.ui.chtree.getNode(e.target);if(e.target&&!s){var o=$(e.target).closest("div.chtree-drag-helper,#chtree-drop-marker").length>0;if(o){return}}t.helper.data("dtTargetNode",s);if(i&&i!==s){i.tree._onDragEvent("leave",i,r,e,t,n)}if(s){if(!s.tree.options.dnd.onDrop){}else if(s===i){s.tree._onDragEvent("over",s,r,e,t,n)}else{s.tree._onDragEvent("enter",s,r,e,t,n)}}},stop:function(e,t){var n=$(this).data("ui-draggable")||$(this).data("draggable"),r=t.helper.data("dtSourceNode")||null,i=t.helper.data("dtTargetNode")||null,s=e.type,o=s=="mouseup"&&e.which==1;if(!o){}if(i){if(o){i.tree._onDragEvent("drop",i,r,e,t,n)}i.tree._onDragEvent("leave",i,r,e,t,n)}if(r){r.tree._onDragEvent("stop",r,null,e,t,n)}}});didRegisterDnd=true}})(jQuery);(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function(e){function n(e){return e}function r(e){return decodeURIComponent(e.replace(t," "))}function i(e){if(e.indexOf('"')===0){e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{return s.json?JSON.parse(e):e}catch(t){}}var t=/\+/g;var s=e.cookie=function(t,o,u){if(o!==undefined){u=e.extend({},s.defaults,u);if(typeof u.expires==="number"){var a=u.expires,f=u.expires=new Date;f.setDate(f.getDate()+a)}o=s.json?JSON.stringify(o):String(o);return document.cookie=[s.raw?t:encodeURIComponent(t),"=",s.raw?o:encodeURIComponent(o),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join("")}var l=s.raw?n:r;var c=document.cookie.split("; ");var h=t?undefined:{};for(var p=0,d=c.length;p<d;p++){var v=c[p].split("=");var m=l(v.shift());var g=l(v.join("="));if(t&&t===m){h=i(g);break}if(!t){h[m]=i(g)}}return h};s.defaults={};e.removeCookie=function(t,n){if(e.cookie(t)!==undefined){e.cookie(t,"",e.extend(n,{expires:-1}));return true}return false}})