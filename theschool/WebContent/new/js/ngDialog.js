!function(a,b){"undefined"!=typeof module&&module.exports?"undefined"==typeof angular?module.exports=b(require("angular")):module.exports=b(angular):"function"==typeof define&&define.amd?define(["ng-dialog"],function(){b(a.angular)}):b(a.angular)}(this,function(a){"use strict";var b=a.module("ngDialog",[]),c=a.element,d=a.isDefined,e=(document.body||document.documentElement).style,f=d(e.animation)||d(e.WebkitAnimation)||d(e.MozAnimation)||d(e.MsAnimation)||d(e.OAnimation),g="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",h="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",i="ngdialog-disabled-animation",j={html:!1,body:!1},k={},l=[],m=!1;return b.provider("ngDialog",function(){var b=this.defaults={className:"ngdialog-theme-default",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceHtmlReload=function(a){j.html=a||!1},this.setForceBodyReload=function(a){j.body=a||!1},this.setDefaults=function(c){a.extend(b,c)};var n,d=0,e=0,o={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(p,q,r,s,t,u,v,w,x,y){var z=[],A={onDocumentKeydown:function(a){27===a.keyCode&&B.close("$escape")},activate:function(a){var b=a.data("$ngDialogOptions");b.trapFocus&&(a.on("keydown",A.onTrapFocusKeydown),z.body.on("keydown",A.onTrapFocusKeydown))},deactivate:function(a){a.off("keydown",A.onTrapFocusKeydown),z.body.off("keydown",A.onTrapFocusKeydown)},deactivateAll:function(b){a.forEach(b,function(b){var c=a.element(b);A.deactivate(c)})},setBodyPadding:function(a){var b=parseInt(z.body.css("padding-right")||0,10);z.body.css("padding-right",b+a+"px"),z.body.data("ng-dialog-original-padding",b),u.$broadcast("ngDialog.setPadding",a)},resetBodyPadding:function(){var a=z.body.data("ng-dialog-original-padding");a?z.body.css("padding-right",a+"px"):z.body.css("padding-right",""),u.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(a,b){var c=a.data("$ngDialogOptions"),d=a.attr("id"),h=k[d];if(h){if("undefined"!=typeof w.Hammer){var i=h.hammerTime;i.off("tap",n),i.destroy&&i.destroy(),delete h.hammerTime}else a.unbind("click");1===e&&z.body.unbind("keydown",A.onDocumentKeydown),a.hasClass("ngdialog-closing")||(e-=1);var j=a.data("$ngDialogPreviousFocus");j&&j.focus&&j.focus(),u.$broadcast("ngDialog.closing",a,b),e=e<0?0:e,f&&!c.disableAnimation?(h.$destroy(),a.unbind(g).bind(g,function(){A.closeDialogElement(a,b)}).addClass("ngdialog-closing")):(h.$destroy(),A.closeDialogElement(a,b)),o[d]&&(o[d].resolve({id:d,value:b,$dialog:a,remainingDialogs:e}),delete o[d]),k[d]&&delete k[d],l.splice(l.indexOf(d),1),l.length||(z.body.unbind("keydown",A.onDocumentKeydown),m=!1)}},closeDialogElement:function(a,b){a.remove(),0===e&&(z.html.removeClass("ngdialog-open"),z.body.removeClass("ngdialog-open"),A.resetBodyPadding()),u.$broadcast("ngDialog.closed",a,b)},closeDialog:function(b,c){var d=b.data("$ngDialogPreCloseCallback");if(d&&a.isFunction(d)){var e=d.call(b,c);a.isObject(e)?e.closePromise?e.closePromise.then(function(){A.performCloseDialog(b,c)}):e.then(function(){A.performCloseDialog(b,c)},function(){}):e!==!1&&A.performCloseDialog(b,c)}else A.performCloseDialog(b,c)},onTrapFocusKeydown:function(b){var d,c=a.element(b.currentTarget);if(c.hasClass("ngdialog"))d=c;else if(d=A.getActiveDialog(),null===d)return;var e=9===b.keyCode,f=b.shiftKey===!0;e&&A.handleTab(d,b,f)},handleTab:function(a,b,c){var d=A.getFocusableElements(a);if(0===d.length)return void(document.activeElement&&document.activeElement.blur());var e=document.activeElement,f=Array.prototype.indexOf.call(d,e),g=f===-1,h=0===f,i=f===d.length-1,j=!1;c?(g||h)&&(d[d.length-1].focus(),j=!0):(g||i)&&(d[0].focus(),j=!0),j&&(b.preventDefault(),b.stopPropagation())},autoFocus:function(a){var b=a[0],d=b.querySelector("*[autofocus]");if(null===d||(d.focus(),document.activeElement!==d)){var e=A.getFocusableElements(a);if(e.length>0)return void e[0].focus();var f=A.filterVisibleElements(b.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(f.length>0){var g=f[0];c(g).attr("tabindex","-1").css("outline","0"),g.focus()}}},getFocusableElements:function(a){var b=a[0],c=b.querySelectorAll(h),d=A.filterTabbableElements(c);return A.filterVisibleElements(d)},filterTabbableElements:function(a){for(var b=[],d=0;d<a.length;d++){var e=a[d];"-1"!==c(e).attr("tabindex")&&b.push(e)}return b},filterVisibleElements:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];(d.offsetWidth>0||d.offsetHeight>0)&&b.push(d)}return b},getActiveDialog:function(){var a=document.querySelectorAll(".ngdialog");return 0===a.length?null:c(a[a.length-1])},applyAriaAttributes:function(a,b){if(b.ariaAuto){if(!b.ariaRole){var c=A.getFocusableElements(a).length>0?"dialog":"alertdialog";b.ariaRole=c}b.ariaLabelledBySelector||(b.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),b.ariaDescribedBySelector||(b.ariaDescribedBySelector="article,section,p")}b.ariaRole&&a.attr("role",b.ariaRole),A.applyAriaAttribute(a,"aria-labelledby",b.ariaLabelledById,b.ariaLabelledBySelector),A.applyAriaAttribute(a,"aria-describedby",b.ariaDescribedById,b.ariaDescribedBySelector)},applyAriaAttribute:function(a,b,d,e){if(d&&a.attr(b,d),e){var f=a.attr("id"),g=a[0].querySelector(e);if(!g)return;var h=f+"-"+b;return c(g).attr("id",h),a.attr(b,h),h}},detectUIRouter:function(){try{return a.module("ui.router"),!0}catch(a){return!1}},getRouterLocationEventName:function(){return A.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},B={open:function(f){function G(a,b){return u.$broadcast("ngDialog.templateLoading",a),t.get(a,b||{}).then(function(b){return u.$broadcast("ngDialog.templateLoaded",a),b.data||""})}function H(b){return b?a.isString(b)&&g.plain?b:"boolean"!=typeof g.cache||g.cache?G(b,{cache:q}):G(b,{cache:!1}):"Empty template"}var g=a.copy(b),h=++d,j="ngdialog"+h;l.push(j),f=f||{},a.extend(g,f);var p;o[j]=p=s.defer();var C;k[j]=C=a.isObject(g.scope)?g.scope.$new():u.$new();var D,E,F=a.extend({},g.resolve);return a.forEach(F,function(b,c){F[c]=a.isString(b)?y.get(b):y.invoke(b,null,null,c)}),s.all({template:H(g.template||g.templateUrl),locals:s.all(F)}).then(function(b){var d=b.template,f=b.locals;g.showClose&&(d+='<div class="ngdialog-close"></div>');var k=g.overlay?"":" ngdialog-no-overlay";if(D=c('<div id="ngdialog'+h+'" class="ngdialog'+k+'"></div>'),D.html(g.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+d+"</div>":'<div class="ngdialog-content" role="document">'+d+"</div>"),D.data("$ngDialogOptions",g),C.ngDialogId=j,g.data&&a.isString(g.data)){var l=g.data.replace(/^\s*/,"")[0];C.ngDialogData="{"===l||"["===l?a.fromJson(g.data):g.data,C.ngDialogData.ngDialogId=j}else g.data&&a.isObject(g.data)&&(C.ngDialogData=g.data,C.ngDialogData.ngDialogId=j);if(g.className&&D.addClass(g.className),g.disableAnimation&&D.addClass(i),E=g.appendTo&&a.isString(g.appendTo)?a.element(document.querySelector(g.appendTo)):z.body,A.applyAriaAttributes(D,g),g.preCloseCallback){var o;a.isFunction(g.preCloseCallback)?o=g.preCloseCallback:a.isString(g.preCloseCallback)&&C&&(a.isFunction(C[g.preCloseCallback])?o=C[g.preCloseCallback]:C.$parent&&a.isFunction(C.$parent[g.preCloseCallback])?o=C.$parent[g.preCloseCallback]:u&&a.isFunction(u[g.preCloseCallback])&&(o=u[g.preCloseCallback])),o&&D.data("$ngDialogPreCloseCallback",o)}if(C.closeThisDialog=function(a){A.closeDialog(D,a)},g.controller&&(a.isString(g.controller)||a.isArray(g.controller)||a.isFunction(g.controller))){var p;g.controllerAs&&a.isString(g.controllerAs)&&(p=g.controllerAs);var q=x(g.controller,a.extend(f,{$scope:C,$element:D}),null,p);D.data("$ngDialogControllerController",q)}if(v(function(){var a=document.querySelectorAll(".ngdialog");A.deactivateAll(a),r(D)(C);var b=w.innerWidth-z.body.prop("clientWidth");z.html.addClass("ngdialog-open"),z.body.addClass("ngdialog-open");var c=b-(w.innerWidth-z.body.prop("clientWidth"));c>0&&A.setBodyPadding(c),E.append(D),A.activate(D),g.trapFocus&&A.autoFocus(D),g.name?u.$broadcast("ngDialog.opened",{dialog:D,name:g.name}):u.$broadcast("ngDialog.opened",D)}),m||(z.body.bind("keydown",A.onDocumentKeydown),m=!0),g.closeByNavigation){var s=A.getRouterLocationEventName();u.$on(s,function(){A.closeDialog(D)})}if(g.preserveFocus&&D.data("$ngDialogPreviousFocus",document.activeElement),n=function(a){var b=!!g.closeByDocument&&c(a.target).hasClass("ngdialog-overlay"),d=c(a.target).hasClass("ngdialog-close");(b||d)&&B.close(D.attr("id"),d?"$closeButton":"$document")},"undefined"!=typeof w.Hammer){var t=C.hammerTime=w.Hammer(D[0]);t.on("tap",n)}else D.bind("click",n);return e+=1,B}),{id:j,closePromise:p.promise,close:function(a){A.closeDialog(D,a)}}},openConfirm:function(b){var d=s.defer(),e={closeByEscape:!1,closeByDocument:!1};a.extend(e,b),e.scope=a.isObject(e.scope)?e.scope.$new():u.$new(),e.scope.confirm=function(a){d.resolve(a);var b=c(document.getElementById(f.id));A.performCloseDialog(b,a)};var f=B.open(e);return f.closePromise.then(function(a){return a?d.reject(a.value):d.reject()}),d.promise},isOpen:function(a){var b=c(document.getElementById(a));return b.length>0},close:function(a,b){var d=c(document.getElementById(a));if(d.length)A.closeDialog(d,b);else if("$escape"===a){var e=l[l.length-1];d=c(document.getElementById(e)),d.data("$ngDialogOptions").closeByEscape&&A.closeDialog(d,"$escape")}else B.closeAll(b);return B},closeAll:function(a){for(var b=document.querySelectorAll(".ngdialog"),d=b.length-1;d>=0;d--){var e=b[d];A.closeDialog(c(e),a)}},getOpenDialogs:function(){return l},getDefaults:function(){return b}};return a.forEach(["html","body"],function(a){if(z[a]=p.find(a),j[a]){var b=A.getRouterLocationEventName();u.$on(b,function(){z[a]=p.find(a)})}}),B}]}),b.directive("ngDialog",["ngDialog",function(b){return{restrict:"A",scope:{ngDialogScope:"="},link:function(c,d,e){d.on("click",function(d){d.preventDefault();var f=a.isDefined(c.ngDialogScope)?c.ngDialogScope:"noScope";a.isDefined(e.ngDialogClosePrevious)&&b.close(e.ngDialogClosePrevious);var g=b.getDefaults();b.open({template:e.ngDialog,className:e.ngDialogClass||g.className,controller:e.ngDialogController,controllerAs:e.ngDialogControllerAs,bindToController:e.ngDialogBindToController,scope:f,data:e.ngDialogData,showClose:"false"!==e.ngDialogShowClose&&("true"===e.ngDialogShowClose||g.showClose),closeByDocument:"false"!==e.ngDialogCloseByDocument&&("true"===e.ngDialogCloseByDocument||g.closeByDocument),closeByEscape:"false"!==e.ngDialogCloseByEscape&&("true"===e.ngDialogCloseByEscape||g.closeByEscape),overlay:"false"!==e.ngDialogOverlay&&("true"===e.ngDialogOverlay||g.overlay),preCloseCallback:e.ngDialogPreCloseCallback||g.preCloseCallback})})}}}]),b});